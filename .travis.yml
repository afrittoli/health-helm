services: docker
language: python

env:
  - BLUEMIX_DOMAIN=ng.bluemix.net IMAGE_REG=registry.ng.bluemix.net/ci-pipeline CLUSTER_DOMAIN=ci-dev.us-south.containers.appdomain.cloud

before_install:
  - curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64 && chmod +x skaffold && mv skaffold ~/build/
  - curl -sL https://ibm.biz/idt-installer -o idt-installer && bash idt-installer

before_script:
# Login into IBM cloud services and registry
  - bx login -a https://api.$BLUEMIX_DOMAIN
  - bx target -o "Developer Advocacy" -s dev
  - bx cr login

script:
  - cd ~/build/$TRAVIS_REPO_SLUG
  - ./ci/deploy_and_cleanup.sh
