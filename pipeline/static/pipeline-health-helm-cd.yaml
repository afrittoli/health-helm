apiVersion: pipeline.knative.dev/v1alpha1
kind: Pipeline
metadata:
  name: health-helm-cd-pipeline
spec:
  tasks:
  - name: source-to-image-health-api
    taskRef:
      name: source-to-image
    params:
      - name: pathToContext
        value: images/api
  - name: source-to-image-health-frontend
    taskRef:
      name: source-to-image
    params:
      - name: pathToContext
        value: images/frontend
  - name: source-to-image-health-database
    taskRef:
      name: source-to-image
    params:
      - name: pathToContext
        value: images/database
  - name: helm-deploy-target-cluster
    taskRef:
      name: helm-deploy
    params:
      - name: pathToHelmCharts
        value: .
      - name: chartname
        value: health
      - name: clusterIngressHost
        value: afhealth.sjc03.containers.appdomain.cloud
    resources:
      - name: api-image
        providedBy:
          - source-to-image-health-api
      - name: frontend-image
        providedBy:
          - source-to-image-health-frontend
      - name: database-image
        providedBy:
          - source-to-image-health-database
